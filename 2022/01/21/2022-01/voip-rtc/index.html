<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>VoIP和RTC | 笔记本</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="术语VoIPVoIP: Voice over Internet Protocol基于IP的语音传输。只是概念，不对应具体协议栈、有不同实现。别名：IP电话、互联网电话、宽带电话、宽带电话服务。VoIP可用于包括VoIP电话、智能手机、个人计算机在内的诸多互联网接入设备，通过蜂窝网络、Wi-Fi进行通话及发送短信。 VoIP的实现迭代:(1)DSL&#x2F;cable调制解调器(2)Wifi&#x2F;3G(3)LT">
<meta property="og:type" content="article">
<meta property="og:title" content="VoIP和RTC">
<meta property="og:url" content="http://xiaoyue26.github.io/2022/01/21/2022-01/voip-rtc/index.html">
<meta property="og:site_name" content="笔记本">
<meta property="og:description" content="术语VoIPVoIP: Voice over Internet Protocol基于IP的语音传输。只是概念，不对应具体协议栈、有不同实现。别名：IP电话、互联网电话、宽带电话、宽带电话服务。VoIP可用于包括VoIP电话、智能手机、个人计算机在内的诸多互联网接入设备，通过蜂窝网络、Wi-Fi进行通话及发送短信。 VoIP的实现迭代:(1)DSL&#x2F;cable调制解调器(2)Wifi&#x2F;3G(3)LT">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://xiaoyue26.github.io/images/2022-01/voip_transfer.png">
<meta property="og:image" content="http://xiaoyue26.github.io/images/2022-01/web_rtc_sip.png">
<meta property="og:image" content="http://xiaoyue26.github.io/images/2022-01/webrtc.png">
<meta property="og:image" content="http://xiaoyue26.github.io/images/2022-01/webrtc_support.png">
<meta property="og:image" content="http://xiaoyue26.github.io/images/2022-01/sfu_mcu.png">
<meta property="article:published_time" content="2022-01-21T06:14:50.000Z">
<meta property="article:modified_time" content="2022-01-21T10:12:40.249Z">
<meta property="article:author" content="风梦七">
<meta property="article:tag" content="voip">
<meta property="article:tag" content="rtc">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://xiaoyue26.github.io/images/2022-01/voip_transfer.png">
  
    <link rel="alternate" href="/atom.xml" title="笔记本" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    
  
  
<link rel="stylesheet" href="/css/style.css">

  

<meta name="generator" content="Hexo 4.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    
    <div id="header-inner" class="inner">
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://xiaoyue26.github.io"></form>
      </div>
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">首页</a>
        
          <a class="main-nav-link" href="/archives">归档</a>
        
          <a class="main-nav-link" href="/about">关于</a>
        
      </nav>
      
    </div>
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">笔记本</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">风梦七</a>
        </h2>
      
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-2022-01/voip-rtc" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/01/21/2022-01/voip-rtc/" class="article-date">
  <time datetime="2022-01-21T06:14:50.000Z" itemprop="datePublished">2022-01-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/rtc/">rtc</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      VoIP和RTC
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <h1 id="术语"><a href="#术语" class="headerlink" title="术语"></a>术语</h1><h2 id="VoIP"><a href="#VoIP" class="headerlink" title="VoIP"></a>VoIP</h2><p>VoIP: <code>Voice over Internet Protocol</code><br>基于IP的语音传输。只是概念，不对应具体协议栈、有不同实现。<br>别名：IP电话、互联网电话、宽带电话、宽带电话服务。<br>VoIP可用于包括VoIP电话、智能手机、个人计算机在内的诸多互联网接入设备，通过蜂窝网络、Wi-Fi进行通话及发送短信。</p>
<p>VoIP的实现迭代:<br>(1)DSL/cable调制解调器<br>(2)Wifi/3G<br>(3)LTE<br>(4)RCS</p>
<h2 id="V-VoIP"><a href="#V-VoIP" class="headerlink" title="V.VoIP"></a>V.VoIP</h2><p><code>Video over IP</code><br>一些V.VoIP的基本要素包括信令、媒体引擎、会话描述协议（SDP）、实时传输协议/实时控制协议（RTP/RTCP）、<br>网络地址转换（NAT）、安全协议、服务质量（QoS），以及其余电话组件。<br>V.VoIP实质上是封装了全部这一切，再加上用户界面，包括拨号、通信录/联系人列表和呼叫历史记录（未接/已接/已拨电话），<br>以提供一个完整的V.VoIP客户端。</p>
<h2 id="RTC"><a href="#RTC" class="headerlink" title="RTC"></a>RTC</h2><p>RTC: <code>Real-Time Communications</code><br>RTC也就是实时交流。一般是指音\视频。日常生活中的例子包括：微信通话、视频会议、直播PK连麦、在线教育。</p>
<p>上述两种概念，都看重”端到端延时”指标，大致定义如下:</p>
<img src="/images/2022-01/voip_transfer.png" class="" width="800" height="1200" title="transfer">
<p>从这个流程，可以看出相比于普通文本传输，主要是多了和音视频相关的”采集”、”处理”、”编码”等操作。<br>其中的”网络”部分，由于VoIP是从电话网络演化而来，主要侧重于原来的电话网到IP网络；<br>RTC则主要侧重于IP网络。</p>
<h2 id="SIP协议"><a href="#SIP协议" class="headerlink" title="SIP协议"></a>SIP协议</h2><p><code>Session initialization Protocol</code><br>一种信令协议。<br>VoIP的具体实现的其中一部分的协议，主要做控制层（信令），基于文本。（RFC 2543, RFC 3261~3265）大致开始于1999年。</p>
<h2 id="WebRTC"><a href="#WebRTC" class="headerlink" title="WebRTC"></a>WebRTC</h2><p>谷歌收购GIPS引擎，与GTalk通信库合并，2011年纳入Chrome体系并开源，命名为WebRTC。<br>2012年获各大浏览器厂商支持，纳入W3C标准。</p>
<img src="/images/2022-01/web_rtc_sip.png" class="" width="800" height="1200" title="web_rtc_sip.png">

<p>WebRTC的架构大致如下，主要是给前端提供了封装好的API，屏蔽底层硬件。：</p>
<img src="/images/2022-01/webrtc.png" class="" width="800" height="1200" title="webrtc">

<p>绝大部分浏览器的新版本都支持webRTC:</p>
<img src="/images/2022-01/webrtc_support.png" class="" width="800" height="1200" title="webrtc_support.png">

<h2 id="RTMP"><a href="#RTMP" class="headerlink" title="RTMP"></a>RTMP</h2><p>RTMP: 是Real Time Messaging Protocol的简称，<br>基于 <em>TCP</em> 协议，用来进⾏实时数据通信的⽹络协议，<br>推流到CDN即用的是RTMP;</p>
<h2 id="SRS"><a href="#SRS" class="headerlink" title="SRS"></a>SRS</h2><p><code>Simple Realtime Server</code><br>互联网直播服务器集群的开源框架;<br><a href="https://github.com/ossrs/srs/wiki/v2_CN_Home" target="_blank" rel="noopener">https://github.com/ossrs/srs/wiki/v2_CN_Home</a></p>
<h1 id="发展历史"><a href="#发展历史" class="headerlink" title="发展历史"></a>发展历史</h1><h2 id="1996～2004：H323"><a href="#1996～2004：H323" class="headerlink" title="1996～2004：H323"></a>1996～2004：H323</h2><p>电话线上网时代；</p>
<h3 id="H-323标准"><a href="#H-323标准" class="headerlink" title="H.323标准"></a>H.323标准</h3><p>ITU（国际电信联盟）推出，<br>基于传统 PSTN 架构（Public Switched Telephone Network，公共交换电话网）。<br>(MCU+RTP)<br>H.323标准的VOIP网络中：<br>用户呼叫021号码：先送到上海、再到目的地；<br>在SIP中：直接查，无短途长途之分。</p>
<p>场景：PC语音会议；<br>优点：达到了可通话的质量；<br>缺点：MCU是中心化的，拓展性有上限。有合流成本。</p>
<h2 id="2001～2007-P2P-Mesh"><a href="#2001～2007-P2P-Mesh" class="headerlink" title="2001～2007: P2P/Mesh"></a>2001～2007: P2P/Mesh</h2><p>IETF, SIP(UDP + HTTP) 软交换</p>
<p>Skype: 超级节点+P2P/Mesh通信， 通信质量接近PSTN网络;<br>GTalk: 谷歌山寨的Skype</p>
<p>瑞典GIPS公司：开发出3A算法；<br>GIPS被谷歌收购，GIPS与 GTalk 的libjingle合并成为早期WebRTC一部分。</p>
<p>场景：社交IM的1v1通信；<br>优点：轻量级、架构拓展性强；<br>缺点：跨运营商无法保证Qos，去中心化后无法监控、管控；</p>
<h2 id="2003～2012-SFU"><a href="#2003～2012-SFU" class="headerlink" title="2003～2012: SFU"></a>2003～2012: SFU</h2><p>MMO RPG游戏兴起；</p>
<p>场景：游戏频道语音沟通、直播聊天室。<br>优点：架构简洁、实时性强，无需中心化合流聚合；<br>缺点：客户端下行压力大，互动人数有最大上限；</p>
<h2 id="SFU-vs-MCU"><a href="#SFU-vs-MCU" class="headerlink" title="SFU vs MCU"></a>SFU vs MCU</h2><p>SFU : Selective Forwarding Unit, 上行一路流，下行N路流，服务端仅转发。客户端压力大。<br>MCU: MultiPoint Control Unit, 中心化，上行下行都一路流，服务端负责合流。服务端压力大。</p>
<img src="/images/2022-01/sfu_mcu.png" class="" width="800" height="1200" title="sfu_mcu.png">

<h1 id="基础评估指标"><a href="#基础评估指标" class="headerlink" title="基础评估指标"></a>基础评估指标</h1><h2 id="性能相关："><a href="#性能相关：" class="headerlink" title="性能相关："></a>性能相关：</h2><ul>
<li>功耗</li>
<li>cpu/gpu/内存占用</li>
<li>引发降频时间(手机)<h2 id="屏幕分享相关"><a href="#屏幕分享相关" class="headerlink" title="屏幕分享相关"></a>屏幕分享相关</h2></li>
<li>清晰度&amp;分辨率</li>
<li>色彩准确度</li>
<li>相对静止场景最低码率</li>
<li>相对运动场景流畅度（文档滚动、局部动画）<br>基础端到端延时(&lt;1s)<h2 id="音频相关"><a href="#音频相关" class="headerlink" title="音频相关"></a>音频相关</h2></li>
<li>频宽</li>
<li>基础音质（POLQA评分&gt;2.5）</li>
<li>基础端到端延时</li>
<li>3A(增益控制、噪声一直、回声抵消)<h2 id="视频相关"><a href="#视频相关" class="headerlink" title="视频相关"></a>视频相关</h2></li>
<li>基础画质</li>
<li>基础流畅度（帧率、帧间隔）</li>
<li>基础端到端延时</li>
<li>音画同步</li>
</ul>
<h1 id="直播过程"><a href="#直播过程" class="headerlink" title="直播过程"></a>直播过程</h1><h2 id="对于主播："><a href="#对于主播：" class="headerlink" title="对于主播："></a>对于主播：</h2><p>1。申请开始直播:http; // 返回ok<br>2。获取推流目标:信令服务器 -&gt; 创建房间-&gt; 获取当前位置合适的MCU节点；<br>3。KTP推流到MCU节点；（UDP）<br>4。MCU存到SRS(经过RTMP转码);</p>
<h2 id="对于用户-拉数据"><a href="#对于用户-拉数据" class="headerlink" title="对于用户,拉数据:"></a>对于用户,拉数据:</h2><p>用户 -(flv over http)-&gt; CDN -&gt; Router -&gt; SRS</p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p><a href="https://segmentfault.com/a/1190000040760567" target="_blank" rel="noopener">https://segmentfault.com/a/1190000040760567</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://xiaoyue26.github.io/2022/01/21/2022-01/voip-rtc/" data-id="ckyo0y0pf0000sdamb78d2vl7" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/rtc/" rel="tag">rtc</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/voip/" rel="tag">voip</a></li></ul>

    </footer>
  </div>
  
    
 
<script src="/jquery/jquery.min.js"></script>

  <div id="random_posts">
    <h2>推荐文章</h2>
    <div class="random_posts_ul">
      <script>
          var random_count =4
          var site = {BASE_URI:'/'};
          function load_random_posts(obj) {
              var arr=site.posts;
              if (!obj) return;
              // var count = $(obj).attr('data-count') || 6;
              for (var i, tmp, n = arr.length; n; i = Math.floor(Math.random() * n), tmp = arr[--n], arr[n] = arr[i], arr[i] = tmp);
              arr = arr.slice(0, random_count);
              var html = '<ul>';
            
              for(var j=0;j<arr.length;j++){
                var item=arr[j];
                html += '<li><strong>' + 
                item.date + ':&nbsp;&nbsp;<a href="' + (site.BASE_URI+item.uri) + '">' + 
                (item.title || item.uri) + '</a></strong>';
                if(item.excerpt){
                  html +='<div class="post-excerpt">'+item.excerpt+'</div>';
                }
                html +='</li>';
                
              }
              $(obj).html(html + '</ul>');
          }
          $('.random_posts_ul').each(function () {
              var c = this;
              if (!site.posts || !site.posts.length){
                  $.getJSON(site.BASE_URI + 'js/posts.js',function(json){site.posts = json;load_random_posts(c)});
              } 
               else{
                load_random_posts(c);
              }
          });
      </script>
    </div>
  </div>

    
<nav id="article-nav">
  
    <a href="/2022/02/16/2022-02/http-range/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">上一篇</strong>
      <div class="article-nav-title">
        
          http_range
        
      </div>
    </a>
  
  
    <a href="/2021/07/26/2021-07/metaspace%E7%AC%94%E8%AE%B0/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">下一篇</strong>
      <div class="article-nav-title">metaspace笔记</div>
    </a>
  
</nav>

  
</article>
 
     
  <div class="comments" id="comments">
    
     
       
      <div id="cloud-tie-wrapper" class="cloud-tie-wrapper"></div>
    
       
      
      
  </div>
 
  

</section>
           
    <aside id="sidebar">
  
    

  
    
    <div class="widget-wrap">
    
      <div class="widget" id="toc-widget-fixed">
      
        <strong class="toc-title">文章目录</strong>
        <div class="toc-widget-list">
              <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#术语"><span class="toc-number">1.</span> <span class="toc-text">术语</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#VoIP"><span class="toc-number">1.1.</span> <span class="toc-text">VoIP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#V-VoIP"><span class="toc-number">1.2.</span> <span class="toc-text">V.VoIP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RTC"><span class="toc-number">1.3.</span> <span class="toc-text">RTC</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SIP协议"><span class="toc-number">1.4.</span> <span class="toc-text">SIP协议</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#WebRTC"><span class="toc-number">1.5.</span> <span class="toc-text">WebRTC</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RTMP"><span class="toc-number">1.6.</span> <span class="toc-text">RTMP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SRS"><span class="toc-number">1.7.</span> <span class="toc-text">SRS</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#发展历史"><span class="toc-number">2.</span> <span class="toc-text">发展历史</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1996～2004：H323"><span class="toc-number">2.1.</span> <span class="toc-text">1996～2004：H323</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#H-323标准"><span class="toc-number">2.1.1.</span> <span class="toc-text">H.323标准</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2001～2007-P2P-Mesh"><span class="toc-number">2.2.</span> <span class="toc-text">2001～2007: P2P&#x2F;Mesh</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2003～2012-SFU"><span class="toc-number">2.3.</span> <span class="toc-text">2003～2012: SFU</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SFU-vs-MCU"><span class="toc-number">2.4.</span> <span class="toc-text">SFU vs MCU</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#基础评估指标"><span class="toc-number">3.</span> <span class="toc-text">基础评估指标</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#性能相关："><span class="toc-number">3.1.</span> <span class="toc-text">性能相关：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#屏幕分享相关"><span class="toc-number">3.2.</span> <span class="toc-text">屏幕分享相关</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#音频相关"><span class="toc-number">3.3.</span> <span class="toc-text">音频相关</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#视频相关"><span class="toc-number">3.4.</span> <span class="toc-text">视频相关</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#直播过程"><span class="toc-number">4.</span> <span class="toc-text">直播过程</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#对于主播："><span class="toc-number">4.1.</span> <span class="toc-text">对于主播：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#对于用户-拉数据"><span class="toc-number">4.2.</span> <span class="toc-text">对于用户,拉数据:</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#参考资料"><span class="toc-number">5.</span> <span class="toc-text">参考资料</span></a></li></ol>
          </div>
      </div>
    </div>

  
    

  
    
  
    
  
    

  
</aside>

      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-left">
      &copy; 2014 - 2022 风梦七&nbsp;|&nbsp;
      主题 <a href="https://github.com/giscafer/hexo-theme-cafe/" target="_blank">Cafe</a>
    </div>
     <div id="footer-right">
      联系方式&nbsp;|&nbsp;296671657@qq.com
    </div>
  </div>
</footer>
 
<script src="/jquery/jquery.min.js"></script>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/archives" class="mobile-nav-link">归档</a>
  
    <a href="/about" class="mobile-nav-link">关于</a>
  
</nav>
    <img class="back-to-top-btn" src="/images/fly-to-top.png"/>
<script>
// Elevator script included on the page, already.
window.onload = function() {
  var elevator = new Elevator({
    selector:'.back-to-top-btn',
    element: document.querySelector('.back-to-top-btn'),
    duration: 1000 // milliseconds
  });
}
</script>
      

  
    <script>
      var cloudTieConfig = {
        url: document.location.href, 
        sourceId: "",
        productKey: "e2fb4051c49842688ce669e634bc983f",
        target: "cloud-tie-wrapper"
      };
    </script>
    <script src="https://img1.ws.126.net/f2e/tie/yun/sdk/loader.js"></script>
    

  







<!-- author:forvoid begin -->
<!-- author:forvoid begin -->

<!-- author:forvoid end -->

<!-- author:forvoid end -->


  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      })
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      })
    </script>
    <script type="text/javascript" src="https://cdn.rawgit.com/mathjax/MathJax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


 
<script src="/js/is.js"></script>



  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>


<script src="/js/elevator.js"></script>

  </div>
</body>
</html>